<html>
    <head></head>
    <body>
        <h1>U2F with Node.js</h1>
        <button id="register">Start Registration</button>
        <button id="login">Start Login</button>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://raw.githubusercontent.com/google/u2f-ref-code/master/u2f-gae-demo/war/js/u2f-api.js"></script>
        <script>
            $("#register").click(() => {
                if(window.u2f && window.u2f.register) {
                    $.get("https://maics.hqit.kaleyra.com/register", result => {
                        console.log(result);
                        window.u2f.register(result.appId, [result], [], response => {
                            $.post("https://maics.hqit.kaleyra.com/register", { registerResponse: response }, result => {
                                console.log(result);
                            });
                            console.log(response);
                        });
                    });
                } else {
                    document.write("<p>U2F is not supported</p>");
                }
            });
            $("#login").click(() => {
                if(window.u2f && window.u2f.sign) {
                    $.get("https://maics.hqit.kaleyra.com/login", result => {
                        console.log(result);
                        window.u2f.sign(result.appId, result.challenge, [result], response => {
                            $.post("https://maics.hqit.kaleyra.com/login", { loginResponse: response }, result => {
                                console.log(result);
                            });
                            console.log(response);
                        });
                    });
                } else {
                    document.write("<p>U2F is not supported</p>");
                }
            });
        </script>
    </body>
</html>
